<!-- templates/formulario.html -->
{% extends "layout.html" %}

{% block title %}Formulario de Permisos{% endblock %}

{% block content %}
{% if current_user.is_authenticated %}
  <div class="alert alert-success">
    ðŸ‘‹ Â¡Bienvenido, {{ current_user.email }}!
  </div>
{% endif %}
  <h1 class="mb-4">Formulario de Permisos</h1>

  <!-- SELECCIONAR DOCENTE -->
  <form method="post" class="card card-body mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-6">
        <label class="form-label">Docente</label>
        <select name="docente" class="form-select" required id="docenteSelect">
          <option value="">-- Seleccione --</option>
          {% for d in docentes %}
            <option value="{{ d.id }}" {% if docente_seleccionado and docente_seleccionado.id == d.id %}selected{% endif %}>
              {{ d.nombre }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <button type="submit" name="ver_historial" class="btn btn-primary w-100">Ver historial</button>
      </div>
    </div>
  </form>

  <!-- HISTORIAL -->
  {% if historial %}
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        HistÃ³rico de permisos de: <strong>{{ docente_seleccionado.nombre }}</strong>
      </div>
      <div class="card-body p-0">
        <table class="table table-striped table-bordered mb-0">
          <thead class="table-light">
            <tr>
              <th>Inicio</th>
              <th>Fin</th>
              <th>Tipo</th>
              <th>ObservaciÃ³n</th>
            </tr>
          </thead>
          <tbody>
            {% for p in historial %}
              <tr>
                <td>{{ p.fecha_inicio }}</td>
                <td>{{ p.fecha_fin }}</td>
                <td>{{ p.tipo }}</td>
                <td>{{ p.observacion or '-' }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}

  <!-- NUEVO PERMISO -->
  {% if docente_seleccionado %}
    <div class="card">
      <div class="card-header bg-success text-white">
        Nuevo permiso para: <strong>{{ docente_seleccionado.nombre }}</strong>
      </div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="docente" value="{{ docente_seleccionado.id }}">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Fecha inicio</label>
              <input type="date" name="fecha_inicio" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Fecha fin</label>
              <input type="date" name="fecha_fin" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Tipo</label>
              <select name="tipo" class="form-select">
                {% for t in tipos %}
                  <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="mt-3">
            <label class="form-label">ObservaciÃ³n</label>
            <textarea name="observacion" rows="3" class="form-control"></textarea>
          </div>
          <div class="mt-4">
            <button type="submit" name="guardar" class="btn btn-success">Guardar permiso</button>
          </div>
        </form>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block extra_js %}
  <!-- Tom Select solo si lo usas en esta pÃ¡gina -->
  <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap5.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
  <script>
    new TomSelect('#docenteSelect', {
      create: false,
      placeholder: 'Buscar docente...',
      maxOptions: null
    });
  </script>
{% endblock %}